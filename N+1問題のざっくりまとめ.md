# 調べたことメモ
### N+1問題についてのざっくり理解
**【物語調の例え話】**
郵便屋さんがいます。
Aさん、Bさん、Cさんの家に配達をしなければなりません。

郵便屋さんは最初に郵便局に行って、Aさん宛の手紙を受け取りました。
その後、Aさんのうちに配達しました。

そして次に、Bさんの家に配達するために、郵便局に戻ってBさん宛の手紙を受け取りました。
そして、Bさんのうちに配達しました。

最後に、Cさんの家に配達するために、郵便局に戻ってCさん宛の手紙を受け取りました。
そして、Cさんのうちに配達しました。
息も絶え絶えに、やっと仕事が終わりました。

ここであなたは思うはずです。
## この郵便屋はアホかと。
そして、解決策も思いつくはずです。
## 最初に郵便局で全部手紙を受け取ってから配達しろと。
これがN+1問題です。

**N+1ってなに？**
上記の例でいうと、
- Aさん、Bさん、Cさんの家が3件あるので3→これがN
- 最初に郵便局に行く→これが1

↑の郵便屋はアホなので、「3+1」回受け取りに行く必要がある。
一方、最初から郵便局で全部手紙を受け取れば、「1」ですむ。

**コードで説明すると**
これやっちゃうと、アホの郵便屋の例のようになる
```ruby
User.all.each do |user|
  user.posts.each do |post|
    puts post.title
  end
end
```
この書き方をすると、解決する。
```ruby
User.includes(:posts).each do |user|
  user.posts.each do |post|
    puts post.title
  end
end
```

